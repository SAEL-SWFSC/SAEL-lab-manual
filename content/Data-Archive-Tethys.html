<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.43">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Tethys – SAEL Lab Manual</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../content/Data-Archive-PacmMakara.html" rel="next">
<link href="../content/Data-Archive-NCEI.html" rel="prev">
<link href="../images/favicon.ico" rel="icon">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-d4d76bf8491c20bad77d141916dc28e1.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-4379b0ccadffce622b03caf4c46266b3.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-2060c1fdc48bdcd166b162226a62f917.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-0045eb1c33f61f19c2496553aa0e9380.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../content/Data-Archive.html">Data Management</a></li><li class="breadcrumb-item"><a href="../content/Data-Archive-Methods.html">Data Archive Methods</a></li><li class="breadcrumb-item"><a href="../content/Data-Archive-Tethys.html">Tethys</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-center sidebar-header">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="https://upload.wikimedia.org/wikipedia/commons/7/79/NOAA_logo.svg" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      <div class="sidebar-tools-main tools-wide">
    <a href="https://www.fisheries.noaa.gov/west-coast/science-data/southwest-acoustic-ecology-lab" title="Southwest Acoustic Ecology Lab, SWFSC" class="quarto-navigation-tool px-1" aria-label="Southwest Acoustic Ecology Lab, SWFSC"><i class="bi bi-globe"></i></a>
    <a href="https://github.com/SAEL-SWFSC" title="SAEL Github" class="quarto-navigation-tool px-1" aria-label="SAEL Github"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/SharedValues-BestPractices.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Shared Values</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">Lab Management</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/Safety-Lab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">General Lab Safety</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/Safety_Lithium-Batteries.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lithium Batteries</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/Inventory.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Inventory</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Data Management</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/Data-Archive.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Archive</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../content/Data-Archive-Methods.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Archive Methods</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/Data-Archive-GCP.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Google Cloud</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/Data-Archive-NCEI.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">NCEI</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/Data-Archive-Tethys.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Tethys</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/Data-Archive-PacmMakara.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">PACM/Makara</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/Data-Archive-InPort.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">InPort</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/Data-SpeciesAndCallTypes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Species and Call Types</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/media.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Media</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../content/Hardware.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hardware Methods</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/Hardware_Gliders.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">PAM Gliders</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/Hardware_Drifters.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Drifting Recorders</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/Hardware_Towed-Hydrophone.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Towed Array</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/Hardware_Sonobuoys.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sonobuoys</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/Hardware_Handheld-Hydrophone.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Handheld Hydrophone User Manual</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../content/SAEL-Analysis-software.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SAEL Acoustic Software</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/Acoustic-Analysis-software.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Acoustic Analysis Software</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/Ocean-Alert-App.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Ocean Alert App</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/Analysis-Methods.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Analysis Methods</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/Permits_Reporting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Permits &amp; Reporting</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/publications.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Publications</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../content/OpenScience.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Open Science</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#accessing-data" id="toc-accessing-data" class="nav-link active" data-scroll-target="#accessing-data">Accessing Data</a>
  <ul class="collapse">
  <li><a href="#tethys-web-interface" id="toc-tethys-web-interface" class="nav-link" data-scroll-target="#tethys-web-interface">Tethys Web Interface</a></li>
  <li><a href="#tethys-data-explorer" id="toc-tethys-data-explorer" class="nav-link" data-scroll-target="#tethys-data-explorer">Tethys Data Explorer</a></li>
  </ul></li>
  <li><a href="#archiving-deployment-metadata" id="toc-archiving-deployment-metadata" class="nav-link" data-scroll-target="#archiving-deployment-metadata">Archiving Deployment Metadata</a>
  <ul class="collapse">
  <li><a href="#deployment-worksheet-prep-script" id="toc-deployment-worksheet-prep-script" class="nav-link" data-scroll-target="#deployment-worksheet-prep-script">Deployment Worksheet Prep Script</a></li>
  <li><a href="#importing-deployment-worksheets-to-tethys" id="toc-importing-deployment-worksheets-to-tethys" class="nav-link" data-scroll-target="#importing-deployment-worksheets-to-tethys">Importing Deployment Worksheets To Tethys</a></li>
  </ul></li>
  <li><a href="#archiving-detections" id="toc-archiving-detections" class="nav-link" data-scroll-target="#archiving-detections">Archiving Detections</a></li>
  <li><a href="#updating-the-database" id="toc-updating-the-database" class="nav-link" data-scroll-target="#updating-the-database">Updating the Database</a>
  <ul class="collapse">
  <li><a href="#xqueries" id="toc-xqueries" class="nav-link" data-scroll-target="#xqueries">XQueries</a></li>
  <li><a href="#reuploading-data" id="toc-reuploading-data" class="nav-link" data-scroll-target="#reuploading-data">Reuploading Data</a></li>
  </ul></li>
  <li><a href="#more-info" id="toc-more-info" class="nav-link" data-scroll-target="#more-info">More info</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/SAEL-SWFSC/SAEL-lab-manual/edit/main/content/Data-Archive-Tethys.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/SAEL-SWFSC/SAEL-lab-manual/blob/main/content/Data-Archive-Tethys.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li><li><a href="https://github.com/SAEL-SWFSC/SAEL-lab-manual/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../content/Data-Archive.html">Data Management</a></li><li class="breadcrumb-item"><a href="../content/Data-Archive-Methods.html">Data Archive Methods</a></li><li class="breadcrumb-item"><a href="../content/Data-Archive-Tethys.html">Tethys</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Tethys</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="accessing-data" class="level2">
<h2 class="anchored" data-anchor-id="accessing-data">Accessing Data</h2>
<p>All ADRIFT, PASCAL, and CCES deployment metadata and detection data are archived locally in our lab’s Tethys database.</p>
<p>The Tethys database is saved locally on the DON server (<em>Z:/ANALYSIS/Tethys</em>). Tethys has multiple ways to access/visualize the database, but these directions will only include opening the web client interface (main web app and Data Explorer).</p>
<section id="tethys-web-interface" class="level3">
<h3 class="anchored" data-anchor-id="tethys-web-interface">Tethys Web Interface</h3>
<ol type="1">
<li><p>Open Tethys batch file (<em>Z:/ANALYSIS/Tethys/databases/metadata/tethys.bat</em>)</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>This may take a while to load if you have never accessed this database or if you are accessing it remotely (up to an hour)</p>
</div>
</div></li>
<li><p>Once the <em>tethys.bat</em> file has loaded, you should see a website address in the command window to open the web interface (this will include your computer name)</p>
<p><img src="images/TethysCLI.jpg" class="img-fluid"></p></li>
<li><p>Navigate to the web address and you should see the following screen</p>
<p><img src="images/tethysWebInterface.jpg" class="img-fluid"></p></li>
<li><p>Follow the Tethys documentation for <a href="https://tethys.sdsu.edu/distribution/current-docs/WebClient.pdf">interacting with the web client</a></p></li>
</ol>
</section>
<section id="tethys-data-explorer" class="level3">
<h3 class="anchored" data-anchor-id="tethys-data-explorer">Tethys Data Explorer</h3>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
The Tethys server (<em>tethys.bat</em>) must be running to use the Data Explorer
</div>
</div>
<div class="callout-body-container callout-body">

</div>
</div>
<ol type="1">
<li>Navigate to the Data Explorer batch file (<em>Z:/ANALYSIS/Tethys/DataExplorer/data_explorer.bat</em>)</li>
<li>If you are using swc-srankin1-d desktop, skip to step 5. Otherwise, proceed to step 3</li>
<li>Right click on <em>data_explorer.bat, and select edit</em></li>
<li>Update the server argument to point to your computer/server name (changing “<em>..</em>/python<em>39/python.exe data_explorer.py –server <a href="http://swc-srankin1-d.nmfs.local:9779" class="uri">http://swc-srankin1-d.nmfs.local:9779</a></em>” to “<em>..</em>/python<em>39/python.exe data_explorer.py –server <a href="http://swc-kourtney-l.nmfs.local:9779" class="uri">http://swc-kourtney-l.nmfs.local:9779</a></em>”</li>
<li>Save and close, and double click on <em>data_explorer.bat</em> to run the batch file</li>
<li>There will be a series of automatic queries to access the database, and then you should see a prompt to open the Data Explorer at another web address. It should be <a href="http://127.0.0.1:8050/"><em>http://127.0.0.1:8050/</em></a></li>
<li>See Tethys <a href="https://tethys.sdsu.edu/distribution/current-docs/DataExplorerManual.pdf">Data Explorer documentation</a> for more information</li>
</ol>
</section>
</section>
<section id="archiving-deployment-metadata" class="level2">
<h2 class="anchored" data-anchor-id="archiving-deployment-metadata">Archiving Deployment Metadata</h2>
<p>Any new deployments saved in the Deployment Details spreadsheet need to be archived to our Tethys database.</p>
<section id="deployment-worksheet-prep-script" class="level3">
<h3 class="anchored" data-anchor-id="deployment-worksheet-prep-script">Deployment Worksheet Prep Script</h3>
<p>Follow these steps to prepare a Deployment Worksheet for Tethys</p>
<ol type="1">
<li><p>Clone the <a href="https://github.com/asimonis/TethysSAEL">TethysSAEL repository</a> to your local computer and open the <a href="https://github.com/asimonis/TethysSAEL/blob/main/R/Create_Deployment_Worksheet.R"><em>Create_Deployment_Worksheet.R</em></a>file</p></li>
<li><p>Make sure the deployments you want to archive are saved to the <em>deployDetails</em> sheet in <em>Deployment Details</em>, download the file as a .xslx, and save it to ‘~TethysSAEL\Deployment Worksheets’, overwriting the previous version if needed</p></li>
<li><p>In the <em>Create_Deployment_Worksheet.R</em> file, run lines 24-104 to create the function to make the worksheet</p></li>
<li><p>See the example function use in lines 9-14</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">##Example</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># change your project name as needed and number of repetitions</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>ProjectID <span class="ot">=</span> <span class="fu">rep</span>(<span class="st">'CalCurCEAS'</span>,<span class="dv">25</span>) </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># List out the deployment ID for each deployment you want to package</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>DepID<span class="ot">=</span><span class="fu">c</span>(<span class="st">'006'</span>,<span class="st">'008'</span>,<span class="st">'009'</span>,<span class="st">'010'</span>,<span class="st">'011'</span>,<span class="st">'012'</span>,<span class="st">'013'</span>,<span class="st">'014'</span>,<span class="st">'015'</span>,<span class="st">'016'</span>,<span class="st">'017'</span>,<span class="st">'018'</span>,<span class="st">'019'</span>,<span class="st">'020'</span>,<span class="st">'021'</span>,<span class="st">'022'</span>,<span class="st">'023'</span>,<span class="st">'024'</span>,<span class="st">'025'</span>,<span class="st">'026'</span>,<span class="st">'027'</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the function for the deployments set above</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">mapply</span>(makeTethysDep,ProjectID,DepID)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>The output worksheets will be save to the main Deployment Worksheet folder. Move them to a project specific folder</p></li>
<li><p>Push your new Deployment Worksheets back to the repository</p></li>
</ol>
</section>
<section id="importing-deployment-worksheets-to-tethys" class="level3">
<h3 class="anchored" data-anchor-id="importing-deployment-worksheets-to-tethys">Importing Deployment Worksheets To Tethys</h3>
<p>There are a variety of ways to import data to Tethys, these directions will cover the web client and Matlab based uploads. See <a href="https://tethys.sdsu.edu/documentation/">Tethys Documentation</a> for other options and more details</p>
<section id="web-client-uploads" class="level4">
<h4 class="anchored" data-anchor-id="web-client-uploads">Web Client Uploads</h4>
<ol type="1">
<li><p>Follow the steps in the Tethys Web Interface section above to start the server and open the Web Client</p></li>
<li><p>In the top right, click on the dropdown and select ‘Import data’</p>
<p><img src="images/tethysImportData1.jpg" class="img-fluid" width="359"></p></li>
<li><p>Set the Import Map to SWFSC.Mobile.Deployments.MultiChannel.wGPS.wSensors.wNotes, Collection to Deployments, and Species Coding to NOAA.NMFS.v4</p></li>
<li><p>Click on + Data Source, and ensure Microsoft Excel Driver is selected. Set the Source Name to swfsc</p></li>
<li><p>Click Select to choose a deployment worksheet to upload, or drag a file into the window.</p></li>
<li><p>Your screen should now look something like this</p>
<p><img src="images/tethysimport.jpg" class="img-fluid"></p></li>
<li><p>If you are making corrections to an existing Deployment Sheet, check the ‘Overwrite existing’ box. Click Upload to Tethys and the processing will start. If there is an error it will show up below step 3 in the image above. If there are no errors it will show the following message</p>
<p><img src="images/tethysImportSuccess.jpg" class="img-fluid"></p></li>
</ol>
</section>
<section id="matlab-based-uploads" class="level4">
<h4 class="anchored" data-anchor-id="matlab-based-uploads">Matlab Based Uploads</h4>
<p>Note: This is currently not working so these are the general directions, however no screenshots are available to show step by step changes</p>
<ol type="1">
<li><p>Follow the steps in the Tethys Web Interface section above to start the server. Note, the web interface does not need to be open at this time</p></li>
<li><p>Open Matlab and enter the following into the command window</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode matlab code-with-copy"><code class="sourceCode matlab"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">% Fill in your server name in the second argument</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="va">dbSubmit</span>(<span class="ss">'Server'</span><span class="op">,</span> <span class="ss">'http://SWC-SRANKIN1-D.nmfs.local:9779'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>A new window should open called ‘Tethys Import Metadata’</p></li>
<li><p>If not already set, change the Tethys Server to match your server</p></li>
<li><p>Set Collection to Deployments, Import Map to SWFSC.Mobile.Deployments.MultiChannel.wGPS.wSensors.wNotes, and Species Abbreviations to NOAA.NMFS.v4</p></li>
<li><p>Select the file you want to import by setting the path in the File import Tab (select Overwrite existing if making updates to existing files)</p></li>
<li><p>Click Submit to Tethys and the process will start. Similar to the web client, messages will appear in the box below to indicate any errors or if the file upload was a success.</p></li>
<li><p>You can use this option to batch process by setting the path to a folder, rather than an individual file</p></li>
</ol>
</section>
</section>
</section>
<section id="archiving-detections" class="level2">
<h2 class="anchored" data-anchor-id="archiving-detections">Archiving Detections</h2>
<p>Similar to archiving deployments, in progress</p>
</section>
<section id="updating-the-database" class="level2">
<h2 class="anchored" data-anchor-id="updating-the-database">Updating the Database</h2>
<p>There are several methods to update existing documents in the database. These directions will cover Matlab based XQuery methods and a simple reuploading method.</p>
<section id="xqueries" class="level3">
<h3 class="anchored" data-anchor-id="xqueries">XQueries</h3>
<p>To update existing database entries, you can pass Matlab an XQuery that points to a specific node and includes an updated value for that node. An example XQuery and sample Matlab script are included <a href="https://github.com/SAEL-SWFSC/SAEL-lab-manual/tree/ce04a6ebf7cfd968f81deeb8e5a7b53905a152c3/supplemental/Tethys%20Matlab%20Example">here</a>.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Make sure you have backed up a copy of your database before attempting to update
</div>
</div>
<div class="callout-body-container callout-body">

</div>
</div>
<section id="creating-a-new-xquery" class="level4">
<h4 class="anchored" data-anchor-id="creating-a-new-xquery">Creating a new XQuery</h4>
<p>Follow the format of the example XQuery <a href="https://github.com/SAEL-SWFSC/SAEL-lab-manual/blob/ce04a6ebf7cfd968f81deeb8e5a7b53905a152c3/supplemental/Tethys%20Matlab%20Example/swfsc_update.xq">here</a></p>
<ol type="1">
<li>Identify the specific node you want to change. You can find deployments and detection files in the Tethys web browser (click on Tethys icon in top right and select an option from ‘Document listings per collection’). In the example file, we are interested in the audio sensor number from ADRIFT 102 and we want to change it from 856142 to 856141. Change this information to match your node of interest</li>
<li>Save the XQuery with a descriptive name to ‘Z:’</li>
</ol>
</section>
<section id="running-query-and-updated-database" class="level4">
<h4 class="anchored" data-anchor-id="running-query-and-updated-database">Running Query and Updated Database</h4>
<ol type="1">
<li>Open the Tethys batch file (see directions <a href="https://sael-swfsc.github.io/SAEL-lab-manual/content/Data-Archive-Tethys.html#tethys-web-interface">here</a>) and check the server name. You should see something like http://YourComputerName.local:9779 or just http://localhost:9779</li>
<li>Open <a href="https://github.com/SAEL-SWFSC/SAEL-lab-manual/blob/ce04a6ebf7cfd968f81deeb8e5a7b53905a152c3/supplemental/Tethys%20Matlab%20Example/TethysXQueryExample.m">TethysXQueryExample.m script</a> in Matlab</li>
<li>Add a new Matlab path with subfolders to “Z:”. This will point you to the correct path in the SAEL lab Tethys database and allow you to use Tethys functions and commands</li>
<li>Run line 5 in the script to initiate connection to the database. If your server name from step 1 is different then ‘localhost:9779’ you will need to change the second argument from ‘localhost’ to the name of your server (example YourComputerName.local)</li>
<li>Test the connection to the database by running line 7. If you see a new item in the workspace title DeploymentInfo with all deployments listed you can proceed to step 6</li>
<li>Ensure the path to the .xq file is correct and run line 12</li>
<li>To check if the database was uploaded, you can navigate to the specific node using the Tethys web interface query tools</li>
</ol>
</section>
</section>
<section id="reuploading-data" class="level3">
<h3 class="anchored" data-anchor-id="reuploading-data">Reuploading Data</h3>
<p>You can also update the database by editing the existing document and reuploading it to the Database.</p>
<section id="deployment-example" class="level4">
<h4 class="anchored" data-anchor-id="deployment-example">Deployment Example</h4>
<p>In this example, I want to change the ADRIFT 102 audio sensor channel 1 number from 856142 to 856141</p>
<ol type="1">
<li>Find and download the ADRIFT 102 deployment worksheet (all deployment worksheets should be stored <a href="https://github.com/asimonis/TethysSAEL/tree/main/Deployment%20Worksheets">here</a></li>
<li>Open the worksheet and navigate to the SensorNumber field on the Sensor tab. Change the sensor number for channel 1</li>
<li>Save the worksheet and ensure the updated one is reuploaded <a href="https://github.com/asimonis/TethysSAEL/tree/main/Deployment%20Worksheets">here</a></li>
<li>Follow the directions <a href="https://sael-swfsc.github.io/SAEL-lab-manual/content/Data-Archive-Tethys.html#archiving-deployment-metadata">here</a> to import the updated deployment worksheet using one of the methods described. Make sure the ‘Overwrite existing’ box is selected to add your updates to the database</li>
<li>To check if the database was uploaded, you can navigate to the specific node using the Tethys web interface query tools</li>
</ol>
</section>
</section>
</section>
<section id="more-info" class="level2">
<h2 class="anchored" data-anchor-id="more-info">More info</h2>
<p>See <a href="https://tethys.sdsu.edu/documentation/">Tethys Documentation</a>, <a href="https://github.com/asimonis/TethysSAEL">Tethys SAEL GitHub repository</a>, and our <a href="https://sael-swfsc.github.io/adrift-analysis-methods/content/DataArchive/TethysDeployments.html">detailed ADRIFT methods</a> for more information.</p>
<p>Contact Kourtney Burger (kourtney.burger@noaa.gov) with any questions</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/sael-swfsc\.github\.io\/SAEL-lab-manual");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../content/Data-Archive-NCEI.html" class="pagination-link" aria-label="NCEI">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">NCEI</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../content/Data-Archive-PacmMakara.html" class="pagination-link" aria-label="PACM/Makara">
        <span class="nav-page-text">PACM/Makara</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>© CC-1.0</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/SAEL-SWFSC/SAEL-lab-manual/edit/main/content/Data-Archive-Tethys.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/SAEL-SWFSC/SAEL-lab-manual/blob/main/content/Data-Archive-Tethys.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li><li><a href="https://github.com/SAEL-SWFSC/SAEL-lab-manual/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>This page is built with <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>




</body></html>